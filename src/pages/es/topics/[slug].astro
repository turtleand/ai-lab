---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export const prerender = true;

export async function getStaticPaths() {
  const englishTopics = await getCollection('topics');
  const spanishTopics = await getCollection('topics-es');
  const topicsBySlug = new Map<
    string,
    (typeof englishTopics)[number] | (typeof spanishTopics)[number]
  >();

  englishTopics.forEach((topic) => {
    topicsBySlug.set(topic.slug, topic);
  });

  spanishTopics.forEach((topic) => {
    topicsBySlug.set(topic.slug, topic);
  });

  return Array.from(topicsBySlug.values()).map((topic) => ({
    params: { slug: topic.slug },
    props: { topic }
  }));
}

const { topic } = Astro.props;
const { Content } = await topic.render();

const resolveLink = (link?: string) => {
  if (!link) return undefined;
  if (link.startsWith('/topics/')) return `/es${link}`;
  return link;
};
---

<BaseLayout title={topic.data.title} description={topic.data.summary}>
  <section class="card" aria-labelledby="topic-title-es">
    <div class="pill inline">{topic.data.module}</div>
    <h1 id="topic-title-es">{topic.data.title}</h1>
    <p>{topic.data.summary}</p>
    <div class="tag-row">
      <a class="pill" href="/es">Volver al programa</a>
    </div>
  </section>

  <section class="card" aria-labelledby="topic-content-es">
    <div class="section-title">
      <div>
        <p class="pill inline">Notas del tema</p>
        <h2 id="topic-content-es">Descripci√≥n general</h2>
      </div>
    </div>
    <article class="stacked">
      <Content />
    </article>
  </section>
</BaseLayout>
