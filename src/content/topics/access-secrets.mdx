---
title: "Access & secrets"
module: "Module 0: Fast Track Setup"
subtopic: "access-secrets"
summary: "Configure API keys and secrets securely for model access."
status: "done"
---

## The problem

AI workflows depend on multiple API keys — model providers, transcription services, cloud storage, GitHub. Hardcoding them is a security risk. Leaking one key can compromise your entire setup.

The real challenge isn't just "don't put keys in code." It's managing keys across different contexts: your shell, background services, cron jobs, and web applications — each with different environment scoping rules.

---

## What we set up

Our AI infrastructure uses these services, each requiring separate credentials:

| Service | Purpose | Key type |
|---------|---------|----------|
| Anthropic (Claude) | Primary AI model | API key |
| Deepgram | Voice transcription | API key |
| Brave Search | Web search | API key |
| GitHub (gh CLI) | Repo management | OAuth token |
| Google Drive (rclone) | File sync/backup | OAuth2 refresh token |

That's 5+ secrets to manage across an EC2 instance running 24/7.

---

## Environment variables: the basics

The simplest approach — and what we use — is environment variables. No secrets in files that get committed. No hardcoded values.

### For interactive shells

Add keys to `~/.bashrc`:

```bash
export DEEPGRAM_API_KEY="your-key-here"
export BRAVE_API_KEY="your-key-here"
```

Reload with `source ~/.bashrc`.

**Limitation:** This only works when *you* are logged in. Background services and cron jobs don't load `.bashrc`.

### For systemd services

If your AI agent runs as a systemd service (like OpenClaw does), the service needs its own environment:

```ini
# /etc/systemd/system/your-service.service
[Service]
Environment="DEEPGRAM_API_KEY=your-key-here"
Environment="BRAVE_API_KEY=your-key-here"
```

Or use an `EnvironmentFile` for cleaner separation:

```ini
[Service]
EnvironmentFile=/etc/your-service/env
```

Where `/etc/your-service/env` contains:

```bash
DEEPGRAM_API_KEY=your-key-here
BRAVE_API_KEY=your-key-here
```

**Important:** Set restrictive permissions on the env file:

```bash
sudo chmod 600 /etc/your-service/env
sudo chown root:root /etc/your-service/env
```

After changes, reload systemd:

```bash
sudo systemctl daemon-reload
sudo systemctl restart your-service
```

---

## Experiment: the Deepgram key scoping issue

When we first set up voice transcription, the Deepgram API key worked fine in our interactive shell but failed when called from the OpenClaw agent (running as a systemd service).

**What happened:**
1. Added `DEEPGRAM_API_KEY` to `~/.bashrc` ✅
2. Ran transcription manually — worked ✅
3. Agent tried to transcribe a voice note — `401 Unauthorized` ❌

**Root cause:** The systemd service doesn't inherit the user's shell environment. It runs in an isolated process context.

**Fix:** Added the key to both `~/.bashrc` (for manual use) AND the systemd service environment. After `daemon-reload` and restart, transcription worked from both contexts.

**Lesson learned:** Always test your keys from the same context they'll run in. A key that works in your terminal may not exist in your service's environment.

---

## OAuth-based authentication

Not everything uses API keys. Some services use OAuth flows that require browser-based authentication.

### GitHub CLI (gh)

```bash
gh auth login
```

This opens a browser flow, stores the token locally. The gh CLI manages token refresh automatically. We use this for creating branches, PRs, and managing repos programmatically.

**Where the token lives:** `~/.config/gh/hosts.yml`

### Google Drive (rclone)

```bash
rclone config
```

This walks through an OAuth2 flow for Google Drive access. The refresh token is stored in `~/.config/rclone/rclone.conf`.

We use rclone to sync files to Google Drive:

```bash
rclone copy local-file.md gdrive:OpenClaw/guides/
```

**Key decision:** We scoped access to a single folder (`OpenClaw/`) in Google Drive. Even though rclone *could* access everything, we set a boundary: `OpenClaw/` is read-write, everything else is off-limits. This is a policy decision, not a technical one — enforced by discipline, not configuration.

---

## What NOT to do

Things we actively avoid:

- **Never commit keys to git.** We audited all 6 repos before making them public. Zero secrets found, but we checked.
- **Never put keys in scripts.** Our transcription script reads `$DEEPGRAM_API_KEY` from the environment, not from the script itself.
- **Never share keys across services unnecessarily.** Each service gets only the keys it needs.
- **Never use the same key for dev and production.** (We don't have separate environments yet — this is a gap we acknowledge.)

---

## Our current gaps

Being honest about what we haven't done yet:

- **No key rotation schedule.** Keys have been static since setup. Should rotate periodically.
- **No secrets manager.** Using env files directly, not HashiCorp Vault or AWS Secrets Manager. For a single-machine setup, this is acceptable. For production, it wouldn't be.
- **No separation between dev and prod keys.** Everything runs on one EC2 instance.
- **No audit trail.** We don't log which key was used when. The daily security report checks for anomalies but doesn't track key usage.

---

## Checklist

Before adding a new service to your AI workflow:

1. ☐ Generate a dedicated API key (don't reuse across services)
2. ☐ Add to `~/.bashrc` for interactive use
3. ☐ Add to systemd service environment if running as a daemon
4. ☐ Test from the actual execution context (shell, service, cron)
5. ☐ Set restrictive file permissions on any env files (600)
6. ☐ Verify the key is NOT in any committed files (`grep -r "key" .`)
7. ☐ Document what the key is for (we use TOOLS.md for this)

---

## Sources

- [systemd Environment directives](https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Environment) — official docs on service environment variables
- [rclone configuration](https://rclone.org/docs/) — OAuth setup for cloud storage
- [GitHub CLI auth](https://cli.github.com/manual/gh_auth_login) — token management
